(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/createOrder"],{"5b5d":function(t,e,a){},"6f3c":function(t,e,a){"use strict";a.r(e);var i=a("9c81"),o=a.n(i);for(var r in i)"default"!==r&&function(t){a.d(e,t,function(){return i[t]})}(r);e["default"]=o.a},"7e79":function(t,e,a){"use strict";var i=a("5b5d"),o=a.n(i);o.a},"9c81":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=r(a("a34a")),o=a("2f62");function r(t){return t&&t.__esModule?t:{default:t}}function n(t,e,a,i,o,r,n){try{var s=t[r](n),d=s.value}catch(c){return void a(c)}s.done?e(d):Promise.resolve(d).then(i,o)}function s(t){return function(){var e=this,a=arguments;return new Promise(function(i,o){var r=t.apply(e,a);function s(t){n(r,i,o,s,d,"next",t)}function d(t){n(r,i,o,s,d,"throw",t)}s(void 0)})}}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},i=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),i.forEach(function(e){c(t,e,a[e])})}return t}function c(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var u=function(){return Promise.all([a.e("common/vendor"),a.e("components/rattenking-dtpicker/rattenking-dtpicker")]).then(a.bind(null,"c5fb"))},l={components:{ruiDatePicker:u},data:function(){return{time:"12:00",date:"",iniaTihuoStartTime:"",IniaTihuoEndTime:"",vipCode:void 0,checkName:!1,checkTaxno:!1,ifKaiFaPiao:!1,ifXuni:"false",returnIfOnlyUserBonus:"false",selectFaPiaoType:"个人",pickSiteList:[],orderSetList:[],fapiaoDetail:{id:void 0,orderId:void 0,fapiaoType:void 0,name:void 0,taxno:void 0,address:void 0,telphone:void 0,bank:void 0,bankNo:void 0,money:void 0,status:void 0},coupon:null,isbind:!1,bonus:0,useBonus:0,useBonusMoney:0,goodsTotalPrice:0,orderTotalPrice:0,freightPrice:0,showfreightPrice:0,couponPrice:0,maskState:0,fapiaoState:0,sendwayState:0,desc:"",payType:1,couponList:[],addressData:{},goodList:[{}],cartIds:"",goodId:"",number:"",price:"",comId:"",shopinfo:{},regionList:[],invoice_select:["个人","单位"],sendway_select:["快递","自提取货"],insg_active:0,invoice_good:["商品明细","商品类别"],orderStructData:{cartIds:null,addressId:null,message:"",productId:null,mallOrderTypeCode:null,ruleId:null,number:null,price:null,comId:"1",integralPrice:null,integralBonus:null,freightPrice:null,coupon:[],fapiao:[],sendWay:"快递",pickSiteId:null,pickSiteName:null,pickTime:null,pickPerson:"",pickMobile:"",yuyueStoreId:null,yuyueFetchTime:null}}},onLoad:function(t){this.getPickSiteList(),this.getOderSetInfo();var e=t.productId;this.orderStructData.productId=t.productId,this.goodId=e;var a=t.number;this.orderStructData.number=t.number,this.number=a;var i=t.numbers,o=t.cartIds;null!=t.cartIds&&"undefined"!=t.cartIds&&(this.orderStructData.cartIds=t.cartIds),this.cartIds=o;var r=t.comId;this.orderStructData.comId=t.comId,this.comId=r,null==t.mallOrderTypeCode?this.orderStructData.mallOrderTypeCode="10":this.orderStructData.mallOrderTypeCode=t.mallOrderTypeCode,null!=t.ruleId&&"undefined"!=t.ruleId&&(this.orderStructData.ruleId=t.ruleId),this.price=t.price,this.orderStructData.price=t.price,null!=t.ifXuni&&(this.ifXuni=t.ifXuni),null!=t.returnIfOnlyUserBonus&&(this.returnIfOnlyUserBonus=t.returnIfOnlyUserBonus),this.loadDate(this.goodId,a,o,i)},onShow:function(){this.loadDate(this.goodId,this.number,this.cartIds,this.numbers)},computed:d({},(0,o.mapState)(["hasLogin","userInfo"]),{startDate:function(){return this.getDate("start")},endDate:function(){return this.getDate("end")}}),methods:d({},(0,o.mapMutations)(["login"]),{getOderSetInfo:function(){var t=this;t.$http({method:"GET",url:t.global.target+"/wx/order/getOrderSetList"}).then(function(e){var a=e.data;0==a.errno&&(t.orderSetList=a.data)},function(t){})},getPickSiteList:function(){var t=this;t.$http({method:"GET",params:{name:"",page:1,limit:100},url:t.global.target+"/wx/picksite/list"}).then(function(e){var a=e.data;0==a.errno&&(t.pickSiteList=a.data.list,t.pickSiteList.length>0&&(t.orderStructData.pickSiteId=t.pickSiteList[0].id,t.orderStructData.pickSiteName=t.pickSiteList[0].siteName,t.nowDate(t.pickSiteList[0].sitePickTime)))},function(t){})},getDate:function(t){var e=new Date,a=e.getFullYear(),i=e.getMonth()+1,o=e.getDate();return"start"===t?a=a:"end"===t&&(a+=1),i=i>9?i:"0"+i,o=o>9?o:"0"+o,"".concat(a,"-").concat(i,"-").concat(o)},getDefaultDateValue:function(t){(new Date).getTime();return new Date((new Date).getTime()+3600*t*1e3)},getDayAddSome:function(t,e){var a=new Date(new Date(t).getTime()+24*e*3600*1e3),i=a.getMonth()+1>9?a.getMonth()+1:"0"+(a.getMonth()+1),o=a.getDate()>9?a.getDate():"0"+a.getDate();return a.getFullYear()+"-"+i+"-"+o},nowDate:function(t){this.date=this.iniaTihuoStartTime.substring(0,10),this.time=this.iniaTihuoStartTime.substring(11,16);var e=this.time.substring(0,2);e<"09"&&(e="09"),e>"17"&&(e="17"),this.time=e+":00"},bindDateChange:function(t){this.date=t.detail.value},bindTimeChange:function(t){this.time=t.detail.value},confirmFaPiaoInfo:function(){if(this.checkName=!1,this.checkTaxno=!1,"单位"==this.selectFaPiaoType){if(!this.fapiaoDetail.name)return void(this.checkName=!0);if(!this.fapiaoDetail.taxno)return void(this.checkTaxno=!0)}this.ifKaiFaPiao=!0,this.fapiaoDetail.fapiaoType=this.selectFaPiaoType,this.fapiaotoggleMask()},changeIfKaiFaPiao:function(){this.fapiaotoggleMask("show")},notKaiFaPiao:function(){this.ifKaiFaPiao?this.ifKaiFaPiao=!1:(this.ifKaiFaPiao=!0,this.fapiaotoggleMask("show"))},usebonusChange:function(e){var a=this;0==a.useBonus&&0==e.detail.value||(e.detail.value?a.$http({method:"POST",data:t.getStorageSync("userInfo"),url:this.global.target+"/wx/shoudu/crm/getMoneyWithBonus"}).then(function(e){var i=e.data;if(0==i.errno){var o=i.data,r=o.money,n=o.bonus;if(r>0)if(r>a.orderTotalPrice){if(a.orderTotalPrice<=0)return void a.$api.msg("不能使用积分");a.$http({method:"POST",data:t.getStorageSync("userInfo"),params:{money:a.orderTotalPrice},url:a.global.target+"/wx/shoudu/crm/getBonusWithMoney"}).then(function(t){var e=t.data;0==e.errno?(a.useBonusMoney=e.data.money,a.useBonus=e.data.bonus,a.orderTotalPrice=(a.orderTotalPrice-e.data.money).toFixed(2)):a.$api.msg(e.errmsg)},function(t){})}else a.useBonusMoney=r,a.useBonus=n,a.orderTotalPrice=(a.orderTotalPrice-r).toFixed(2)}else a.$api.msg(i.errmsg)},function(t){}):(null!=a.coupon?a.orderTotalPrice=(a.orderTotalPriceReal-a.coupon.maxAmt).toFixed(2):a.orderTotalPrice=a.orderTotalPriceReal,a.useBonus=0,a.useBonusMoney=0))},loadDate:function(){var t=s(i.default.mark(function t(){var e,a,o,r,n,s;return i.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e=this.goodId,a=this.number,o=this.price,r=this.cartIds,n=this,n.getuserInfo(),s=n.addressData.id,e&&null!=e&&""!=e&&null!=a&&""!=a?n.$http({method:"POST",params:{goodId:e,number:a,price:o,addressId:s},url:n.global.target+"/wx/cart/checkoutinfo"}).then(function(t){var i=t.data;0==i.errno&&(n.iniaTihuoStartTime=i.data.startTime,n.IniaTihuoEndTime=i.data.endTime,n.nowDate(),n.goodList=i.data.checkedGoodsList,n.addressData=i.data.checkedAddress,n.orderStructData.addressId=n.addressData.id,n.regionList=i.data.regionList,n.regionList.forEach(function(t){t.id==n.addressData.province&&n.$set(n.addressData,"provinceName",t.name),t.id==n.addressData.city&&n.$set(n.addressData,"cityName",t.name),t.id==n.addressData.county&&n.$set(n.addressData,"countyName",t.name)}),n.goodsTotalPrice=i.data.goodsTotalPrice,n.orderTotalPrice=i.data.orderTotalPrice,n.orderTotalPriceReal=i.data.orderTotalPrice,n.couponPrice=i.data.couponPrice,n.freightPrice=i.data.freightPrice,n.showfreightPrice=i.data.freightPrice,n.goodId=e,n.number=a)},function(t){}):r&&null!=r&&""!=r&&n.$http({method:"POST",params:{cartIds:r,addressId:s},url:this.global.target+"/wx/cart/checkoutinfo"}).then(function(t){var e=t.data;0==e.errno&&(n.iniaTihuoStartTime=e.data.startTime,n.IniaTihuoEndTime=e.data.endTime,n.nowDate(),n.goodList=e.data.checkedGoodsList,n.addressData=e.data.checkedAddress,n.orderStructData.addressId=n.addressData.id,n.regionList=e.data.regionList,n.goodsTotalPrice=e.data.goodsTotalPrice,n.orderTotalPrice=e.data.orderTotalPrice,n.orderTotalPriceReal=e.data.orderTotalPrice,n.couponPrice=e.data.couponPrice,n.freightPrice=e.data.freightPrice,n.showfreightPrice=e.data.freightPrice,n.cartIds="",n.goodList.forEach(function(t){n.cartIds+=t.id+","}))},function(t){});case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),getuserInfo:function(){var e=this;e.$http({method:"POST",url:this.global.target+"/wx/auth/checkToken"}).then(function(a){console.log(a);var i=a.data;if(0==i.errno){e.login(i.data);var o=t.getStorageSync("userInfo");e.bonus=o.bonus,e.couponList=o.ticketsList,e.orderStructData.pickPerson=o.nickName,e.orderStructData.pickMobile=o.mobile,e.vipCode=o.vipCode,null!=o.vipCode&&""!=o.vipCode&&(e.isbind=!0,console.log(e.isbind)),console.log(e.isbind)}else console.log(a)},function(t){console.log(t)})},selectCoupon:function(t){this.coupon=t,this.orderTotalPrice<t.maxAmt?this.orderTotalPrice=0:this.orderTotalPrice=(this.orderTotalPrice-t.maxAmt).toFixed(2),this.toggleMask()},selectPickSite:function(t){this.orderStructData.pickSiteId=t.id,this.orderStructData.pickSiteName=t.siteName,this.sendwayToggleMask()},toggleMask:function(t){var e=this,a="show"===t?10:300,i="show"===t?1:0;this.maskState=2,setTimeout(function(){e.maskState=i},a)},sendwayToggleMask:function(t){var e=this,a="show"===t?10:300,i="show"===t?1:0;this.sendwayState=2,setTimeout(function(){e.sendwayState=i},a)},fapiaotoggleMask:function(t){var e=this,a="show"===t?10:200,i="show"===t?1:0;this.fapiaoState=2,setTimeout(function(){e.fapiaoState=i},a)},numberChange:function(t){this.number=t.number},changePayType:function(t){this.payType=t},submit:function(){if(null!=this.addressData.name)if(null==this.goodList||this.goodList.length<=0)this.$api.msg("请选择商品");else if("true"==this.returnIfOnlyUserBonus&&this.orderTotalPrice>0)this.$api.msg("该商品只支持用积分购买");else{t.showLoading({title:"请稍后"});var e=this;if(e.orderStructData.integralPrice=e.useBonusMoney,e.orderStructData.integralBonus=e.useBonus,e.orderStructData.freightPrice=e.freightPrice,e.orderStructData.coupon=e.coupon,e.orderStructData.fapiao=1==e.ifKaiFaPiao?e.fapiaoDetail:null,null!=e.orderStructData.pickSiteId){var a=this.date+" "+this.time;e.orderStructData.pickTime=a}e.$http({method:"POST",data:e.orderStructData,url:this.global.target+"/wx/order/submit"}).then(function(a){t.hideLoading();var i=a.data;if(0==i.errno){if(null!=e.coupon){var o=t.getStorageSync("userInfo").ticketsList;o.splice(o.indexOf(e.coupon),1)}e.orderTotalPrice>0?t.redirectTo({url:"/pages/money/pay?orderId="+i.data.orderId+"&pay="+i.data.pay+"&ordersn="+i.data.orderSn}):t.navigateTo({url:"/pages/money/paySuccess?price="+e.pay+"&orderid="+i.data.orderId})}else e.$api.msg(i.errmsg)},function(e){t.hideLoading()})}else this.$api.msg("请选择收货地址")},stopPrevent:function(){},change_ins:function(t){this.selectFaPiaoType=t},change_insg:function(t){this.insg_active=t},change_sendway:function(t){this.orderStructData.sendWay=t,"快递"==t?this.showfreightPrice=this.freightPrice:"自提取货"==t&&(this.showfreightPrice=0)},navToLogin:function(){t.navigateTo({url:"/pages/public/login"})}})};e.default=l}).call(this,a("543d")["default"])},a9a8:function(t,e,a){"use strict";a.r(e);var i=a("af0d"),o=a("6f3c");for(var r in o)"default"!==r&&function(t){a.d(e,t,function(){return o[t]})}(r);a("7e79");var n=a("2877"),s=Object(n["a"])(o["default"],i["a"],i["b"],!1,null,null,null);e["default"]=s.exports},af0d:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},o=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return o})}},[["c632","common/runtime","common/vendor"]]]);
